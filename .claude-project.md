# Meridian ESG - Claude Code Context

## Stack
- Next.js 15.5.0 (App Router, Server Components)
- React 19.0.0 (with new hooks: useActionState, useFormStatus, useOptimistic)
- TypeScript 5.7.3 (strict mode)
- ESLint 9 (flat config in eslint.config.ts)
- Tailwind CSS v4 (CSS-based config with @theme)
- Supabase (with RLS, typed clients)
- pnpm 10.15.0 (via Corepack)

## Golden Exemplars (Follow These Patterns)
- `components/features/organizations/UserProfile.tsx` - Component best practices
- `lib/utils/validation.ts` - Zod validation patterns
- `hooks/queries/use-user-data.ts` - Remote state handling

## Critical Rules
1. NEVER expose service role keys in frontend
2. ALWAYS enable RLS on user-facing tables
3. ALWAYS validate with Zod at boundaries
4. ALWAYS create feature branches: `ai-feature-<name>`
5. ALWAYS write tests before implementation
6. NEVER use localStorage/sessionStorage in artifacts
7. NEVER commit directly to main branch
8. ALWAYS run `pnpm verify` before committing

## File Naming Conventions
- Components: PascalCase (UserProfile.tsx)
- Hooks: kebab-case (use-user-data.ts)
- Utils: kebab-case (validation.ts)
- API routes: kebab-case folders
- Tests: *.test.ts or *.test.tsx

## Before Each Task
```bash
# 1. Create feature branch
git checkout -b ai-feature-<descriptive-name>

# 2. Write tests first (TDD)
pnpm test:watch

# 3. After implementation, verify everything
pnpm verify  # Runs typecheck, lint, and tests

# 4. Commit with clear message
git add .
git commit -m "Task X.X: Description of changes"
```

## Architecture Patterns
- Feature-first UI: `components/features/*`
- Business logic: `services/*.server.ts` (secrets) vs `*.public.ts` (pure)
- API endpoints: `app/api/v1/*` with Zod validation
- Hooks: `hooks/queries/*` and `hooks/mutations/*`
- State: Server state preferred; Zustand for ephemeral UI only

## Security Checklist
- [ ] Service role key NEVER in frontend
- [ ] RLS enabled on ALL user tables
- [ ] Inputs validated with Zod
- [ ] No hardcoded secrets
- [ ] SQL injection prevention
- [ ] XSS prevention
- [ ] CSRF protection

## Testing Requirements
- Minimum 80% coverage
- Unit tests for all utilities
- Integration tests for API routes
- RLS policy tests mandatory
- E2E tests for critical flows

## Performance Targets
- Page load < 2 seconds
- API response < 500ms
- Database query < 100ms
- Lighthouse score > 90
